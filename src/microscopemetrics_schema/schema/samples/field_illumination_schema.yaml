id: https://w3id.org/MontpellierRessourcesImagerie/microscopemetrics-schema/samples/field_illumination_schema
name: microscopemetrics_samples_field_illumination_schema
prefixes:
#  metrics: https://github.com/MontpellierRessourcesImagerie/microscope-metrics/blob/main/src/microscopemetrics/model/
#imports:
#  - metrics:types
  linkml: https://w3id.org/linkml/
imports:
  - linkml:types
  - core_schema  # TODO: change to metrics:core_schema

default_range: string


classes:
  FieldIlluminationDataset:
    is_a: MetricsDataset
    description: >-
      A field illumination dataset
    attributes:
      input:
        range: FieldIlluminationInput
        required: true
        multivalued: false
        inlined: true
      output:
        range: FieldIlluminationOutput
        required: false
        multivalued: false
        inlined: true
    rules:
      - preconditions:
          slot_conditions:
            processed:
              equals_number: 1
        postconditions:
          slot_conditions:
            output:
              required: true

  FieldIlluminationInput:
    is_a: MetricsInput
    slots:
      - field_illumination_image
      - bit_depth
      - saturation_threshold
      - corner_fraction
      - sigma
      - intensity_map_size
    slot_usage:
      saturation_threshold:
        required: true

  FieldIlluminationOutput:
    is_a: MetricsOutput
    attributes:
      key_values:
        range: FieldIlluminationKeyValues
        description: >-
          Key-Value pairs containing the Key measurements for the field illumination analysis
        multivalued: false
        inlined: true
      intensity_profiles:
        range: TableAsDict
        description: >-
          Intensity profiles for the field illumination analysis in the different directions
        multivalued: false
        inlined: true
      intensity_map:
        range: Image5D
        description: >-
          Intensity map of the field illumination
        multivalued: false
        inlined: true
      roi_profiles:
        range: FieldIlluminationProfilesIntensity
        description: line ROIs used to compute the intensity profiles
        multivalued: false
        inlined: true
      roi_corners:
        range: FieldIlluminationCornersIntensities
        description: >-
          Rectangular ROIs used to compute the corner intensities
        multivalued: false
        inlined: true
      roi_centers_of_mass:
        range: FieldIlluminationCentersOfMass
        description: >-
          Point ROIs marking the center of mass of the area of maximum illumination 90 percentile of the intensity.
          When the image is very flat, the 99 percentile is used instead.
          One point per channel.
        multivalued: true
        inlined: true
      roi_centers_geometric:
        range: FieldIlluminationCentersGeometric
        description: >-
          Point ROIs marking the geometric center of the area of maximum illumination.
          One point per channel.
        multivalued: true
        inlined: true
      roi_centers_fitted:
        range: FieldIlluminationCentersFitted
        description: >-
          Point ROIs marking the fitted center of the area of maximum illumination.
          One point per channel.
        multivalued: true
        inlined: true
      roi_centers_max_intensity:
        range: FieldIlluminationCentersMaxIntensity
        description: >-
          Point ROIs marking the maximum intensity of the area of maximum illumination.
          One point per channel.
        multivalued: true
        inlined: true

  FieldIlluminationProfilesIntensity:
    is_a: Roi
    mixins:
      - ProfilesIntensity

  FieldIlluminationCornersIntensities:
    is_a: Roi
    mixins:
      - RoiMeasurements

  FieldIlluminationCentersOfMass:
    is_a: Roi
    mixins:
      - CentersOfMass

  FieldIlluminationCentersGeometric:
    is_a: Roi
    mixins:
      - CentersGeometric

  FieldIlluminationCentersFitted:
    is_a: Roi
    mixins:
      - CentersFitted

  FieldIlluminationCentersMaxIntensity:
    is_a: Roi
    mixins:
      - CentersMaxIntensity

  FieldIlluminationKeyValues:
    is_a: KeyValues
    slots:
      - channel_nr
      - center_region_intensity_fraction
      - center_region_area_fraction
      - center_of_mass_y
      - center_of_mass_y_relative
      - center_of_mass_x
      - center_of_mass_x_relative
      - center_of_mass_distance_relative
      - center_geometric_y
      - center_geometric_y_relative
      - center_geometric_x
      - center_geometric_x_relative
      - center_geometric_distance_relative
      - center_fitted_y
      - center_fitted_y_relative
      - center_fitted_x
      - center_fitted_x_relative
      - center_fitted_distance_relative
      - max_intensity
      - max_intensity_pos_y
      - max_intensity_pos_y_relative
      - max_intensity_pos_x
      - max_intensity_pos_x_relative
      - max_intensity_distance_relative
      - top_left_intensity_mean
      - top_left_intensity_ratio
      - top_center_intensity_mean
      - top_center_intensity_ratio
      - top_right_intensity_mean
      - top_right_intensity_ratio
      - middle_left_intensity_mean
      - middle_left_intensity_ratio
      - middle_center_intensity_mean
      - middle_center_intensity_ratio
      - middle_right_intensity_mean
      - middle_right_intensity_ratio
      - bottom_left_intensity_mean
      - bottom_left_intensity_ratio
      - bottom_center_intensity_mean
      - bottom_center_intensity_ratio
      - bottom_right_intensity_mean
      - bottom_right_intensity_ratio


slots:
  # Inputs
  field_illumination_image:
    range: ImageAsNumpy
    description: >-
      Input parameter: homogeneity image provided as a numpy array in the order TZYXC. While the analysis accepts
      multiple channels, the T and Z dimensions are expected to be 1.
    required: true
    multivalued: false
    inlined: true  # TODO: Why do I do this?
  corner_fraction:
    range: float
    description: >-
      Input parameter: the proportion of the image to be considered as corner or center
    required: true
    multivalued: false
    ifabsent: float(0.1)
    minimum_value: 0.01
    maximum_value: 0.49
  sigma:
    range: float
    description: >-
      Input parameter: the sigma for the smoothing gaussian filter to be applied prior to analysis
    required: true
    multivalued: false
    ifabsent: float(5.0)
    minimum_value: 2.0
    maximum_value: 8.0
  intensity_map_size:
    range: integer
    description: >-
      Input parameter: the size of the output intensity map in pixels
    required: true
    multivalued: false
    ifabsent: int(64)
    minimum_value: 32
    maximum_value: 512
  # Outputs
  center_region_intensity_fraction:
    range: float
    description: >-
      The fraction of the upper intensity range occupied by the center of illumination region.
      That is, a value of 0.1 means that the center of illumination occupies the top 10% of the intensity range.
      microscope-metrics tries to adapt the threshold of this intensity so that the area occupied is not too large.
    multivalued: true
    minimum_value: 0.0
    maximum_value: 1.0
  center_region_area_fraction:
    range: float
    description: >-
      The fraction of the area occupied by the center of illumination region. If the centre upper intensity
      fraction is 0.1, that means that the center of illumination occupies 10% of the area of the image.
    multivalued: true
    minimum_value: 0.0
    maximum_value: 1.0
  center_of_mass_y:
    range: float
    description: >-
      The y coordinate of the center of mass of the center of illumination region. In pixels
    multivalued: true
  center_of_mass_y_relative:
    range: float
    description: >-
      The relative y position of the center of mass of the center of illumination region. 
      Relative to the image size along that axis. -1.0 is upper edge, 0.0 is center and 1.0 is lower edge.
    multivalued: true
    minimum_value: -1.0
    maximum_value: 1.0
  center_of_mass_x:
    range: float
    description: >-
      The x coordinate of the center of mass of the center of illumination region. In pixels
    multivalued: true
  center_of_mass_x_relative:
    range: float
    description: >-
      The relative x position of the center of mass of the center of illumination region. 
      Relative to the image size along that axis. -1.0 is left edge, 0.0 is center and 1.0 is right edge.
    multivalued: true
    minimum_value: -1.0
    maximum_value: 1.0
  center_of_mass_distance_relative:
    range: float
    description: >-
      The relative distance of the centers of mass to the center of the image. Relative to the distance to 
      an image corner. 0.0 is centered and 1.0 at a distance equal to the the corner of the image.
    multivalued: true
    minimum_value: 0.0
    maximum_value: 1.0
  center_geometric_y:
    range: float
    description: >-
      The y coordinate of the geometric center of the center of illumination region. In pixels
    multivalued: true
  center_geometric_y_relative:
    range: float
    description: >-
      The relative y position of the geometric center of the center of illumination region. 
      Relative to the image size along that axis. -1.0 is upper edge, 0.0 is center and 1.0 is lower edge.
    multivalued: true
    minimum_value: -1.0
    maximum_value: 1.0
  center_geometric_x:
    range: float
    description: >-
      The x coordinate of the geometric center of the center of illumination region. In pixels
    multivalued: true
  center_geometric_x_relative:
    range: float
    description: >-
      The relative x position of the geometric center of the center of illumination region. 
      Relative to the image size along that axis. -1.0 is left edge, 0.0 is center and 1.0 is right edge.
    multivalued: true
    minimum_value: -1.0
    maximum_value: 1.0
  center_geometric_distance_relative:
    range: float
    description: >-
      The relative distance of the geometric center to the center of the image. Relative to the distance to 
      an image corner. 0.0 is centered and 1.0 at a distance equal to the the corner of the image.
    multivalued: true
    minimum_value: 0.0
    maximum_value: 1.0
  center_fitted_y:
    range: float
    description: >-
      The y coordinate of the fitted center of illumination. In pixels
    multivalued: true
  center_fitted_y_relative:
    range: float
    description: >-
      The relative y position of the fitted center of illumination. 
      Relative to the image size along that axis. -1.0 is upper edge, 0.0 is center and 1.0 is lower edge.
    multivalued: true
    minimum_value: -1.0
    maximum_value: 1.0
  center_fitted_x:
    range: float
    description: >-
      The x coordinate of the fitted center of illumination. In pixels
    multivalued: true
  center_fitted_x_relative:
    range: float
    description: >-
      The relative x position of the fitted center of illumination. 
      Relative to the image size along that axis. -1.0 is left edge, 0.0 is center and 1.0 is right edge.
    multivalued: true
    minimum_value: -1.0
    maximum_value: 1.0
  center_fitted_distance_relative:
    range: float
    description: >-
      The relative distance of the fitted center of illumination to the center of the image. Relative to the distance to 
      an image corner. 0.0 is centered and 1.0 at a distance equal to the the corner of the image.
    multivalued: true
    minimum_value: 0.0
    maximum_value: 1.0
  max_intensity:
    range: float
    description: >-
      The maximum intensity of the center of illumination
    multivalued: true
  max_intensity_pos_y:
    range: float
    description: >-
      The y coordinate of the maximum intensity of the center of illumination. In pixels
    multivalued: true
  max_intensity_pos_y_relative:
    range: float
    description: >-
      The relative y position of the maximum intensity of the center of illumination. 
      Relative to the image size along that axis. -1.0 is upper edge, 0.0 is center and 1.0 is lower edge.
    multivalued: true
    minimum_value: -1.0
    maximum_value: 1.0
  max_intensity_pos_x:
    range: float
    description: >-
      The x coordinate of the maximum intensity of the center of illumination. In pixels
    multivalued: true
  max_intensity_pos_x_relative:
    range: float
    description: >-
      The relative x position of the maximum intensity of the center of illumination. 
      Relative to the image size along that axis. -1.0 is left edge, 0.0 is center and 1.0 is right edge.
    multivalued: true
    minimum_value: -1.0
    maximum_value: 1.0
  max_intensity_distance_relative:
    range: float
    description: >-
      The relative distance of the maximum intensity to the center of the image. Relative to the distance to 
      an image corner. 0.0 is centered and 1.0 at a distance equal to the the corner of the image.
    multivalued: true
    minimum_value: 0.0
    maximum_value: 1.0
  top_left_intensity_mean:
    range: float
    description: >-
      The mean intensity of the top-left corner of the image
    multivalued: true
  top_left_intensity_ratio:
    range: float
    description: >-
      The mean intensity of the top-left corner of the image 
      divided by the maximum intensity of the center of illumination
    multivalued: true
  top_center_intensity_mean:
    range: float
    description: >-
      The mean intensity of the top-center of the image
    multivalued: true
  top_center_intensity_ratio:
    range: float
    description: >-
      The mean intensity of the top-center of the image 
      divided by the maximum intensity of the center of illumination
    multivalued: true
  top_right_intensity_mean:
    range: float
    description: >-
      The mean intensity of the top-right corner of the image
    multivalued: true
  top_right_intensity_ratio:
    range: float
    description: >-
      The mean intensity of the top-right corner of the image 
      divided by the maximum intensity of the center of illumination
    multivalued: true
  middle_left_intensity_mean:
    range: float
    description: >-
      The mean intensity of the middle-left of the image
    multivalued: true
  middle_left_intensity_ratio:
    range: float
    description: >-
      The mean intensity of the middle-left of the image 
      divided by the maximum intensity of the center of illumination
    multivalued: true
  middle_center_intensity_mean:
    range: float
    description: >-
      The mean intensity of the middle-center of the image
    multivalued: true
  middle_center_intensity_ratio:
    range: float
    description: >-
      The mean intensity of the middle-center of the image 
      divided by the maximum intensity of the center of illumination
    multivalued: true
  middle_right_intensity_mean:
    range: float
    description: >-
      The mean intensity of the middle-right of the image
    multivalued: true
  middle_right_intensity_ratio:
    range: float
    description: >-
      The mean intensity of the middle-right of the image 
      divided by the maximum intensity of the center of illumination
    multivalued: true
  bottom_left_intensity_mean:
    range: float
    description: >-
      The mean intensity of the bottom-left of the image
    multivalued: true
  bottom_left_intensity_ratio:
    range: float
    description: >-
      The mean intensity of the bottom-left of the image 
      divided by the maximum intensity of the center of illumination
    multivalued: true
  bottom_center_intensity_mean:
    range: float
    description: >-
      The mean intensity of the bottom-center of the image
    multivalued: true
  bottom_center_intensity_ratio:
    range: float
    description: >-
      The mean intensity of the bottom-center of the image 
      divided by the maximum intensity of the center of illumination
    multivalued: true
  bottom_right_intensity_mean:
    range: float
    description: >-
      The mean intensity of the bottom-right of the image
    multivalued: true
  bottom_right_intensity_ratio:
    range: float
    description: >-
      The mean intensity of the bottom-right of the image 
      divided by the maximum intensity of the center of illumination
    multivalued: true
